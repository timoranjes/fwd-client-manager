{% extends "base.html" %}

{% block title %}Reports - FWD Client Manager{% endblock %}

{% block content %}
<h1 class="page-title">Reports</h1>

<!-- Stats -->
<div class="row g-3 mb-4">
    <div class="col-6 col-md-3">
        <div class="stat-card">
            <div class="stat-icon blue"><i class="fas fa-users"></i></div>
            <div>
                <div class="stat-value">{{ policy_breakdown|sum(attribute='count') }}</div>
                <div class="stat-label">Total Clients</div>
            </div>
        </div>
    </div>
    <div class="col-6 col-md-3">
        <div class="stat-card">
            <div class="stat-icon green"><i class="fas fa-dollar-sign"></i></div>
            <div>
                <div class="stat-value">
                    {% set total_coverage = policy_breakdown|sum(attribute='total') or 0 %}
                    ${{ "{:,.0f}".format(total_coverage)[:8] }}
                </div>
                <div class="stat-label">Total Coverage</div>
            </div>
        </div>
    </div>
    <div class="col-6 col-md-3">
        <div class="stat-card">
            <div class="stat-icon yellow"><i class="fas fa-file-contract"></i></div>
            <div>
                <div class="stat-value">{{ policy_breakdown|length }}</div>
                <div class="stat-label">Policy Types</div>
            </div>
        </div>
    </div>
    <div class="col-6 col-md-3">
        <div class="stat-card">
            <div class="stat-icon red"><i class="fas fa-chart-line"></i></div>
            <div>
                <div class="stat-value">{{ status_breakdown|selectattr('status', 'equalto', 'Active')|list|length or 0 }}</div>
                <div class="stat-label">Active</div>
            </div>
        </div>
    </div>
</div>

<div class="row g-3">
    <!-- Policy Breakdown -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">Policy Types</div>
            <div class="card-body">
                {% if policy_breakdown %}
                <table class="table" style="font-size: 0.875rem;">
                    <thead>
                        <tr>
                            <th>Type</th>
                            <th>Count</th>
                            <th>Coverage</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for policy in policy_breakdown %}
                        <tr>
                            <td>{{ policy['policy_type'] }}</td>
                            <td>{{ policy['count'] }}</td>
                            <td>${{ "{:,.0f}".format(policy['total'] or 0) }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <div style="text-align: center; color: #6b7280; padding: 20px;">No data available</div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Status Breakdown -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">Status Overview</div>
            <div class="card-body">
                {% if status_breakdown %}
                <div class="row g-2">
                    {% for status in status_breakdown %}
                    {% set colors = {'Active': 'success', 'Expired': 'danger', 'Pending': 'warning', 'Lapsed': 'secondary', 'Cancelled': 'dark'} %}
                    {% set color = colors.get(status['status'], 'secondary') %}
                    <div class="col-6">
                        <div class="d-flex justify-content-between align-items-center p-2 border rounded">
                            <span class="badge-status badge-{{ status['status']|lower }}">{{ status['status'] }}</span>
                            <span style="font-weight: 600;">{{ status['count'] }}</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div style="text-align: center; color: #6b7280; padding: 20px;">No data available</div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Monthly New -->
    <div class="col-12">
        <div class="card">
            <div class="card-header">New Clients (Last 6 Months)</div>
            <div class="card-body">
                {% if monthly_new %}
                <table class="table" style="font-size: 0.875rem;">
                    <thead>
                        <tr>
                            <th>Month</th>
                            <th>New Clients</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for month_data in monthly_new %}
                        <tr>
                            <td>{{ month_data['month'] }}</td>
                            <td style="font-weight: 600;">{{ month_data['count'] }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <div style="text-align: center; color: #6b7280; padding: 20px;">No data available</div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Quick Links -->
<div class="row g-3 mt-2">
    <div class="col-6">
        <a href="{{ url_for('renewals', filter='30') }}" class="quick-btn">
            <i class="fas fa-calendar-check"></i>
            <span>View Renewals</span>
        </a>
    </div>
    <div class="col-6">
        <a href="{{ url_for('export') }}" class="quick-btn">
            <i class="fas fa-download"></i>
            <span>Export Data</span>
        </a>
    </div>
</div>
{% endblock %}
